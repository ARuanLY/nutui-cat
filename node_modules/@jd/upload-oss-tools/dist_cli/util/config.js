"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/*
 * @Author: zhuzhida
 * @Date: 2020-07-30 23:57:38
 * @Last Modified by: zhuzhida
 * @Last Modified time: 2020-09-23 17:34:50
 */
var logger_1 = __importDefault(require("./logger"));
var dic_1 = require("./dic");
var uploadConfig_1 = require("../model/uploadConfig");
var fs = require("fs");
var fse = require("fs-extra");
var jdoss_config_path = dic_1.ROOT_PACKAGE_PATH('../jdoss_config.json');
var config = /** @class */ (function () {
    function config() {
    }
    /**
     * 检查文件是否存在并生成
     * @private
     * @param {string} localFullPath 绝对路径
     * @returns {Promise<boolean>}
     * @memberof oss
     */
    config.checkFile = function (localFullPath) {
        return new Promise(function (resolve, rejects) {
            try {
                fse.ensureFile(localFullPath).then(function () {
                    resolve(true);
                }).catch(function (err) {
                    logger_1.default.error(err);
                    resolve(true);
                });
            }
            catch (e) {
                // logger.error(e)
                resolve(true);
            }
        });
    };
    /**
     *
     * 保存文件
     * @param {uploadConfig} upload_config
     * @returns {Promise<boolean>}
     */
    config.saveFile = function (package_config) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            fs.writeFile(jdoss_config_path, JSON.stringify(package_config), "utf8", function (error) {
                _this.readUploadConfigFile();
                if (error) {
                    logger_1.default.error(error);
                    reject(false);
                }
                resolve(true);
                // logger.success(`${package_config_path} 文件写入成功`);
            });
        });
    };
    /**
     * 读取文件
     */
    config.readUploadConfigFile = function () {
        try {
            return require(jdoss_config_path);
        }
        catch (error) {
            return this.initUploadConfigFile();
            ;
        }
    };
    /**
     * 初始化配置文件
     */
    config.initUploadConfigFile = function () {
        var jdoss_config = new uploadConfig_1.uploadConfig();
        this.saveFile(jdoss_config);
        return jdoss_config;
    };
    return config;
}());
exports.default = config;
